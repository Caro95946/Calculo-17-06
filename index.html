<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Dominio y Rango Interactivo</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f8fafc;
      color: #333;
      margin: 0;
      padding: 2rem;
    }
    .container {
      max-width: 850px;
      margin: auto;
      background: #ffffff;
      border-radius: 1rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      padding: 2rem;
    }
    h1 {
      color: #1e3a8a;
      text-align: center;
      margin-bottom: 1rem;
    }
    input, button {
      font-size: 1rem;
      padding: 0.7rem;
      margin-top: 0.5rem;
      border-radius: 0.5rem;
      border: 1px solid #cbd5e1;
    }
    input {
      width: 100%;
    }
    button {
      background-color: #3b82f6;
      color: white;
      cursor: pointer;
      margin-top: 1rem;
    }
    button:hover {
      background-color: #2563eb;
    }
    .output {
      background-color: #f1f5f9;
      padding: 1rem;
      margin-top: 1.5rem;
      border-radius: 0.5rem;
    }
    #grafico {
      margin-top: 2rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Calculadora de Dominio y Rango</h1>
    <label>Escribe la funci√≥n (Ej: f(x) = 1/(x-2))</label>
    <input id="funcion" type="text" placeholder="Ejemplo: f(x) = 2x + 3">
    <button onclick="graficar()">Graficar e Interpretar</button>

    <div id="resultado" class="output"></div>
    <div id="grafico"></div>
  </div>

  <script>
    function procesarFuncion(raw) {
      raw = raw.toLowerCase().replace(/\s/g, '');
      raw = raw.replace(/^f\(x\)=|^y=|^g\(x\)=/, '');
      raw = raw.replace(/(\d)([a-zA-Z])/g, '$1*$2');       // 2x -> 2*x
      raw = raw.replace(/([a-zA-Z])\(/g, '$1*(');           // x(x+1) -> x*(x+1)
      raw = raw.replace(/\)([a-zA-Z])/g, ')*$1');           // )(x+1) -> )*(x+1)
      return raw;
    }

    function redondear(valor) {
      return Math.round(valor * 100) / 100;
    }

    function graficar() {
      const entrada = document.getElementById("funcion").value;
      const expr = procesarFuncion(entrada);
      const resultado = document.getElementById("resultado");

      let x = [], y = [];
      const minX = -20, maxX = 20, step = 0.1;
      const scope = { x: 0 };

      let funcion;
      try {
        funcion = math.compile(expr);
      } catch (err) {
        resultado.innerHTML = "<b>Error:</b> No se pudo interpretar la funci√≥n.";
        return;
      }

      for (let xi = minX; xi <= maxX; xi += step) {
        try {
          scope.x = xi;
          const yi = funcion.evaluate(scope);
          if (isFinite(yi)) {
            x.push(redondear(xi));
            y.push(redondear(yi));
          }
        } catch {}
      }

      if (x.length < 2) {
        resultado.innerHTML = "<b>Error:</b> No se pudo graficar con suficientes puntos.";
        return;
      }

      const minY = Math.min(...y);
      const maxY = Math.max(...y);
      const domText = `Dominio aproximado: [${x[0]}, ${x[x.length - 1]}]`;
      const ranText = `Rango aproximado: [${minY}, ${maxY}]`;

      let interpretacion = "";

      // Deducci√≥n simple de tipo de funci√≥n
      if (expr.includes("/")) {
        interpretacion += "üí° La funci√≥n tiene posibles asintotas verticales debido a divisiones.<br>";
      }
      if (expr.includes("sqrt") || expr.includes("log") || expr.includes("ln")) {
        interpretacion += "üí° La funci√≥n puede estar definida solo para ciertos valores (ej. positivos).<br>";
      }
      if (expr.includes("^2")) {
        interpretacion += "üí° Parece una par√°bola: el rango puede estar limitado por un m√≠nimo o m√°ximo.<br>";
      }
      if (expr.includes("sin") || expr.includes("cos") || expr.includes("tan")) {
        interpretacion += "üí° Funci√≥n trigonom√©trica detectada: rango acotado y comportamiento peri√≥dico.<br>";
      }

      resultado.innerHTML = `
        ‚úÖ <b>Funci√≥n interpretada:</b> <code>f(x) = ${expr}</code><br><br>
        üìè <b>${domText}</b><br>
        üéØ <b>${ranText}</b><br><br>
        ${interpretacion}
      `;

      Plotly.newPlot("grafico", [{
        x: x,
        y: y,
        mode: "lines",
        line: { color: "#2563eb" }
      }], {
        title: "Gr√°fica de la funci√≥n",
        xaxis: { title: "x" },
        yaxis: { title: "f(x)" },
        margin: { t: 40 }
      }, { scrollZoom: true });
    }
  </script>
</body>
</html>
